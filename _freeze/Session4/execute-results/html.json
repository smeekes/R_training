{
  "hash": "a4d2305fe0e77cbcf15000eb67552cb9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Introduction to R\"\nsubtitle: \"Session 4\"\nauthor: \"\"\nfilters:\n  - diagram\ndiagram:\n  engine:\n    tikz:\n      header-includes:\n        - '\\usepackage{adjustbox,xcolor}'\n        - '\\usetikzlibrary{arrows, shapes}'\n        - '\\definecolor{UMdblue}{RGB}{0,28,61}'\n        - '\\definecolor{UMlblue}{RGB}{0,162,219}'\n        - '\\definecolor{UMorangered}{RGB}{232,78,16}'\n        - '\\definecolor{UMorange}{RGB}{243,148,37}'\n        - '\\definecolor{UMred}{RGB}{174,11,18}'\n---\n\n\n\n## Session Overview\n\n1.  [Inputs and Outputs](#io)\n2.\t[Graphics](#graphics)\n3.  [Bonus: Advanced Graphics with ggplot](#ggplot)\n\n## Today \n\n#### Nalan Bastürk\n\n:::: {.columns}\n\n::: {.column width=\"40%\"}\n![](figures/nalan.jpg){width=50%}\n\n:::\n\n::: {.column width=\"60%\"}\n- Associate Professor at QE\n- Research interests: econometrics, Bayesian statisics, financial econometrics\n- [Website](https://www.maastrichtuniversity.nl/n-bast%C3%BCrk)\n- Sessions 4 and 5\n:::\n\n::::\n\n#### Stephan Smeekes\n\n:::: {.columns}\n\n::: {.column width=\"40%\"}\n![](figures/stephan.jpg){width=50%}\n\n:::\n\n::: {.column width=\"60%\"}\n- Professor of Econometrics at QE\n- Research interests: econometrics, time series, high-dimensional statisics, bootstrap, macro- and climate econometrics \n- [Website](https://stephansmeekes.com)\n- Sessions 2, 3 and 4\n:::\n\n::::\n\n## Inputs and outputs of your R session\n  - Common inputs / outputs of an R session are datasets or R scripts.\n  - For this meeting we focus on datasets as inputs to the R session, loading data and saving data.\n  - The file format (csv, Rdata, xls, stata ...) and directory of the files are important keep in mind.\n  - We will go over a few options, potential issues, and how to avoid the need to type in a long directory name when managing the input and output of the R session.\n  \n## Working directories and R projects\n  - Whenever we provide R with a file name, it can include the full path on the computer.\n  - An alternative is to work on a specified directory.\n  - Another alternative is to work within a 'project' that all paths are visible to the project scripts.\n  - If we do not provide any path, R will use the current “working directory” for reading or writing files. It can be obtained by the command \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  getwd()\n```\n:::\n\n\n\n## Using the correct directory to get input / output of the R session\n- Navigating through the menus in RStudio is easy, (click and go) but requires using the menu every time the user runs the code.\n- Go to *Session* -> *Set Working Directory*. Two convenient options are:  \n\n  +  *Choose Directory...*: Choose the directory yourself\n\n  + *To Source File Location*: Set the working directory to the directory where your **R** Script (the source file) is saved\n\n![](figures/R-script-5.png)\n  <!-- - In top panel in R layout, `Session -> Set working directory /  choose directory' to navigate to the correct directory. -->\n\n  <!-- ![](figures/dir1.png)   -->\n\n## Using the correct directory to get input / output of the R session\n  - An alternative is to use function setwd() at the beginning of your script. This line then has to be changed when the code runs in another machine.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n setwd(\"~/ownCloud (2)/Teaching/Rprogramming_UM/Rprogramming_UM\")\n```\n:::\n\n\n\n## Using the correct directory to get input / output of the R session\n\n- Recall: To set the working directory to the folder where your current R script is located, you can simply use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(this.path)\nsetwd(here()))\n```\n:::\n\n\n\n- Recall: We could also explicitly make the function call from the library:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(this.path::here()))\n```\n:::\n\n\n\n## Types of input or data that can be loaded in R\nR interacts with files in several ways.\n\n  - You can load, save, import, or export a data file. \n  - You can save a generated figure as a graphics file or store regression tables as text, spreadsheet, or LATEX tables.\n  - You can load, save the full workspace (environment) you are working with to follow up another time.\n  \n  Datasets can come in different formats.\n  \n  - Rdata files: Files that can directly \n  - Other file formats (SPSS csv, xls, ...) are also possible to load in R. This often requires the use of packages\n\n## Loading Rdata files\n  - Rdata files are specific to R file formats. \n  - They can store a single object or several objects. \n  - These files are the easiest to manage as input or output in R, since they don't require library calls.\n\n## Load climate data from RData format:\n  - load function is used to load data in Rdata format.\n  - load function loads all objects in the input Rdata file.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"data/climate_Maas_Eind.Rdata\")\nprint(summary(data_short))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       X             STNID               NAME               CTRY          \n Min.   : 87132   Length:2896        Length:2896        Length:2896       \n 1st Qu.: 88219   Class :character   Class :character   Class :character  \n Median : 92226   Mode  :character   Mode  :character   Mode  :character  \n Mean   : 93638                                                           \n 3rd Qu.: 96234                                                           \n Max.   :100154                                                           \n COUNTRY_NAME          ISO2C              ISO3C              LATITUDE    \n Length:2896        Length:2896        Length:2896        Min.   :50.91  \n Class :character   Class :character   Class :character   1st Qu.:50.91  \n Mode  :character   Mode  :character   Mode  :character   Median :51.18  \n                                                          Mean   :51.18  \n                                                          3rd Qu.:51.45  \n                                                          Max.   :51.45  \n   LONGITUDE       ELEVATION          BEGIN               END          \n Min.   :5.375   Min.   : 22.55   Min.   :19490101   Min.   :20240909  \n 1st Qu.:5.375   1st Qu.: 22.55   1st Qu.:19490101   1st Qu.:20240909  \n Median :5.572   Median : 68.42   Median :19490101   Median :20240909  \n Mean   :5.572   Mean   : 68.42   Mean   :19490101   Mean   :20240909  \n 3rd Qu.:5.770   3rd Qu.:114.30   3rd Qu.:19490101   3rd Qu.:20240909  \n Max.   :5.770   Max.   :114.30   Max.   :19490101   Max.   :20240909  \n   YEARMODA              YEAR          MONTH             DAY       \n Length:2896        Min.   :2021   Min.   : 1.000   Min.   : 1.00  \n Class :character   1st Qu.:2021   1st Qu.: 4.000   1st Qu.: 8.00  \n Mode  :character   Median :2022   Median : 7.000   Median :16.00  \n                    Mean   :2022   Mean   : 6.523   Mean   :15.71  \n                    3rd Qu.:2023   3rd Qu.:10.000   3rd Qu.:23.00  \n                    Max.   :2024   Max.   :12.000   Max.   :31.00  \n      YDAY             TEMP       TEMP_ATTRIBUTES DEWP_ATTRIBUTES\n Min.   :  1.00   Min.   :-8.50   Min.   : 7.00   Min.   : 7.00  \n 1st Qu.: 92.75   1st Qu.: 6.90   1st Qu.:24.00   1st Qu.:24.00  \n Median :183.00   Median :11.45   Median :24.00   Median :24.00  \n Mean   :183.10   Mean   :11.69   Mean   :23.88   Mean   :23.88  \n 3rd Qu.:274.00   3rd Qu.:16.80   3rd Qu.:24.00   3rd Qu.:24.00  \n Max.   :366.00   Max.   :30.00   Max.   :24.00   Max.   :24.00  \n SLP_ATTRIBUTES     STP_ATTRIBUTES     VISIB_ATTRIBUTES WDSP_ATTRIBUTES\n Min.   : 0.00000   Min.   : 0.00000   Min.   : 7.00    Min.   : 7.00  \n 1st Qu.: 0.00000   1st Qu.: 0.00000   1st Qu.:24.00    1st Qu.:24.00  \n Median : 0.00000   Median : 0.00000   Median :24.00    Median :24.00  \n Mean   : 0.03729   Mean   : 0.03729   Mean   :23.87    Mean   :23.88  \n 3rd Qu.: 0.00000   3rd Qu.: 0.00000   3rd Qu.:24.00    3rd Qu.:24.00  \n Max.   :13.00000   Max.   :13.00000   Max.   :24.00    Max.   :24.00  \n      MAX            I_FOG        I_RAIN_DRIZZLE     I_SNOW_ICE     \n Min.   :-5.00   Min.   :0.0000   Min.   :0.0000   Min.   :0.00000  \n 1st Qu.:10.20   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000  \n Median :16.00   Median :0.0000   Median :1.0000   Median :0.00000  \n Mean   :15.94   Mean   :0.1381   Mean   :0.6454   Mean   :0.04385  \n 3rd Qu.:22.00   3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:0.00000  \n Max.   :39.50   Max.   :1.0000   Max.   :1.0000   Max.   :1.00000  \n     I_HAIL           I_THUNDER       I_TORNADO_FUNNEL       ES       \n Min.   :0.000000   Min.   :0.00000   Min.   :0        Min.   :0.300  \n 1st Qu.:0.000000   1st Qu.:0.00000   1st Qu.:0        1st Qu.:1.000  \n Median :0.000000   Median :0.00000   Median :0        Median :1.350  \n Mean   :0.004489   Mean   :0.07562   Mean   :0        Mean   :1.478  \n 3rd Qu.:0.000000   3rd Qu.:0.00000   3rd Qu.:0        3rd Qu.:1.900  \n Max.   :1.000000   Max.   :1.00000   Max.   :0        Max.   :4.200  \n```\n\n\n:::\n:::\n\n\n  \n## Load climate data from RData format:\n  - You can assign the loaded data to a new variable\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- load(\"data/climate_Maas_Eind.Rdata\")\n```\n:::\n\n\n\n## Loading other formats of data in R\nOption 1: Using menus within RStudio is the easiest (click and go) but requires using the menu every time the user runs the code.\n  \n![](figures/load1.png)  \n  \n## Loading other formats of data in R\nOption 1: Using menus within RStudio (cont'd)\n  \n![](figures/load2.png)  \n  \n## Loading other formats of data in R\nOption 1: Using menus within RStudio (cont'd)\n  \n![](figures/load3.png)  \n\n## Loading other formats of data in R\nOption 1: Using menus within RStudio (cont'd)\n![](figures/load4.png)  \n\n## Loading other formats of data in R\n\nAdvice for option 1: \n\n  - Copy the command that appears after loading the data from the menus. \n\n![](figures/load5.png)  \n\n## Loading other formats of data in R\n\nAdvice for option 1 (cont'd): \n\n  - Paste the command on top of your script.\n  - This way, next time you do not need the menu navigation.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nclimate <- read_excel(\"data/climate.xlsx\")\n```\n:::\n\n\n  - You can view the data by clicking on it in the `Environment' at the top-right of the workspace. \n\n## General way of importing and exporting of other data formats\n\n  - Using the correct libraries for different data formats can be tedious.\n  - R package rio is very convenient for data import and export. It figures out the type of data format from the file name extension, e.g. *.csv for CSV, *.dta for Stata, or *.sav for SPSS data sets\n  - For a complete list of supported formats, see help(rio). \n  - It calls an appropriate package to do the actual importing or exporting. \n  \n## Loading SPSS and other file types\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary('rio')\nimport(\"data/climate.dta\")\n```\n:::\n\n\n\n## Loading csv files\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimport(\"data/climate.csv\")\n```\n:::\n\n\n\n## Outputs\n\n- Outputs work very similarly to the inputs above.\n- The most relevant outputs formats are the R output formats.\n- `save()` saves objects as an `.RData` file.\n- `save.image()` saves a selection of objects as an `.RData` file.\n\n## Exercise 4.1: Saving data\n- Save your current workspace using function `save.image()`.\n- Save only one variable in the workspace using function `save()`.\n- Make a list of two variables from `data_short`, and save this list using function `save`.\n<!-- save.image('myoutput.Rdata') -->\n<!-- save(climate, 'myclimatedata.Rdata') -->\n<!-- myoutput <- list(data_short$NAME, data_short$LATITUTE) -->\n<!-- save(myoutput, 'myclimatedata.Rdata') -->\n\n## R Base Graphics\n\n-   We will cover R base graphics.\n-   Other alternatives include `ggplot2'...\n\nTo create plots with R's standard `graphics` package, there are *high-level* and *low-level* plotting functions. \n\n- *High-level* functions generate a new graphic (and open a *device*). \n- *Low-level* functions add elements to an existing graphic.\n\n## Simple plots\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(data_short$MAX)     ## Plotting a single variable\n```\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n\n```{.r .cell-code}\nplot(x = data_short$YEAR, y = data_short$MAX)     ## Scatter plot\n```\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-10-2.png){width=960}\n:::\n:::\n\n\n\n## Multiple plots\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1,2)) # multiple plots in a row\nplot(data_short$MAX)     ## Plotting a single variable\nplot(x = data_short$YEAR, y = data_short$MAX)     ## Scatter plot\n```\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n\n## Functions calling methods\nNotice that function `plot()` calls methods. \n\nIt will perform different operations depending on the class of the passed object. (We study the `lm()` function in detail in the next session!)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_result <- lm(MAX~YEAR, data = data_short)\nplot(ols_result)\n```\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-12-2.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-12-3.png){width=960}\n:::\n\n::: {.cell-output-display}\n![](Session4_files/figure-revealjs/unnamed-chunk-12-4.png){width=960}\n:::\n:::\n\n\n\n## Creating and saving a graph\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npdf(\"outputs/plot_data_short.pdf\")                  \nhist(data_short$MAX, breaks = 20)\ndev.off()\n```\n:::\n\n\n## Customizing Graphics\n\n- Adding points to an existing plot\n- Function `dev.off()'is called after all the plotting, to save the file and return control to the screen.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(data_short$MAX, type = \"l\") ## Lines\npoints(data_short$MAX)\n```\n:::\n\n\n\n## Customizing Graphics\n- The `plot()` function takes several many arguments that can change the layout of the plots. See `?par` for all graphical options; there are many!\n\n- Some examples:\n\n  + `col`: color of lines / points\n  + `lty`, `lwd`: Line type and thickness\n  + `pch`: Point type (1-16)\n  + `main`, `sub`: Title, subtitle\n  + `xlab`, `ylab`: x and y axis labels\n  + `log`, `xlog` and `ylog` for logarithmic scales\n  + `xlim`, `ylim`: x and y axis limits (for overriding R's default choices)\n  + `mfcol`, `mfrow`: Multiple plots in one graphics window (column-wise/row-wise)\n\n## Low-Level Graphic Functions\n\n - `lines`: Draw lines\n - `abline`: Quickly add horizontal, vertical lines, and lines using equation $y = bx + a$\n - `points`: Add points\n - `arrows`: Add arrows\n\n---\n\n## Exercise 4.2: Plot maximum temperatures for Maastricht\n\nWe want to visualize the daily maximum temperatures in the climate data `data_short` specifically for Maastricht. First, make a basic plot of variable and `MAX` then customise the plot in the following ways:\n\n1. The title of the X-axis should say 'Year', the title of the Y-axis 'Maximum Temperature'.\n\n2. Make the plot a line plot with a blue line. (Hint: specifying the colour literally as `\"blue\"` works)\n\n3. Make the tick marks appear on the inside of the figure rather than the outside. \n\n4. Calculate the average temperature. \n\n5. Add a horizontal line with the average maximum temperature\n\nYou will need to consult the help file for this exercise; see this therefrom more as an exercise in how to navigate R's help system, than an exercise in plotting (which we will cover in more detail later).\n\nYou may want to ask ChatGPT for help and then try to see if you could also have gotten the same answer yourself; it may not always give you the most straightforward answer though!\n\n<!-- ind <- data_short[,3] == \"MAASTRICHT\" -->\n<!-- data_Maas <- data_short[ind,]  -->\n<!-- plot(data_Maas$MAX, type = 'l', col = 'blue', tck = 0.05) -->\n<!-- mean_max <- mean(data_Maas$MAX) -->\n<!-- abline(h = mean_max) -->\n\n## Manually saving R plots\n\n - Use the plot functions without creating a graph.\n - Use the `plots' area to save image manually.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(x = data_short$YEAR, y = data_short$MAX)     \n```\n:::\n\n\n## Different plot types\n\nYou can manually save graphs of several formats.\n\nBest practice is to save a graph through a device such as pdf or similar:\n\n- `pdf()`: Adobe PDF (easily integrated into LaTeX). \n- `svg()`: Scalable Vector Graphics (commonly used on websites). \n- `png()`, `jpeg()`, `tiff()`, `bmp()`: Various bitmap formats.\n\n\n::: {.cell}\n\n```{.r .cell-code}\njpeg(\"outputs/plot_data_short.jpeg\")                  \nplot(x = data_short$YEAR, y = data_short$MAX)   \ndev.off()\n```\n:::\n\n\n<!-- THEY HAVE PROBABLY NOT SEEN LOOPS!!! -->\n<!-- ## Exercise 4.4: Make a continuous plot of maximum temperatures in Maastricht -->\n\n<!-- - In this exercise we want to visualise the data over time as if data are gradually becoming available. -->\n<!-- - Select a starting sample of the data for Maastricht.  -->\n<!-- - Make a for loop to get increasing windows of the data. -->\n<!-- - Expand your plot with new data within the for loop. -->\n\n<!-- # Create plot window -->\n<!-- plot(1:1000, data_Maas$MAX[1:100], xlim = c(1, nrow(data_Maas)), ylim = range(data_Maas$MAX),\n     xlab = \"Time\", ylab = \"Value\", main = \"Adding Data Over Time\", type = 'l') -->\n<!-- # Gradually add points -->\n<!-- ind <- data_short[,3] == \"MAASTRICHT\" -->\n<!-- data_Maas <- data_short[ind,]  -->\n<!-- for (i in 1001:nrow(data_Maas)) { -->\n<!--   lines(1:i, data_Maas$MAX[1:i], col = \"steelblue\") -->\n<!--   Sys.sleep(0.05)  # Pause to simulate \"gradual\" effect -->\n<!-- } -->\n\n# Bonus: Advanved Graphics using ggplot\n\n## Exercise 4.3: Use other packages for plots\n\n- Make the same plot in R using package `ggplot2'\n- You may want to use ChatGBT since the syntax of `ggplot2' is quite different from what we covered so far.\n\n<!-- library(ggplot2) -->\n<!-- ind <- data_short[,3] == \"MAASTRICHT\" -->\n<!-- data_Maas <- data_short[ind,]  -->\n<!-- # Add an index to identify each observation -->\n<!-- data_Maas$index <- 1:nrow(data_Maas) -->\n<!-- mean_max <- mean(data_Maas$MAX) -->\n<!-- # Line plot: index vs. mpg -->\n<!-- ggplot(data_Maas, aes(x = index, y = MAX)) + -->\n<!--   geom_line(color = \"steelblue\", size = 1) + -->\n<!--   geom_point(color = \"steelblue\") + -->\n<!--   geom_hline(yintercept = mean_max, color = \"red\", linetype = \"dashed\", size = 1)  -->\n<!--   labs(title = \"Max temp. in Maastricht\", -->\n<!--        x = \"Observation Index\", -->\n<!--        y = \"Max temperature\")  -->\n\n\n",
    "supporting": [
      "Session4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}